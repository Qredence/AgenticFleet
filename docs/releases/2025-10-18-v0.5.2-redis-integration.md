# Release 0.5.2 ‚Äì Redis Context & Workflow Hardening

**Date:** October 18, 2025
**Tag:** `v0.5.2`

This patch deepens our integration with the Microsoft Agent Framework by adopting the official Redis extensions for context retrieval and chat history. It also fixes the lingering issues with plan-review streaming and approval propagation introduced in 0.5.1.

---

## üîç Highlights

- **Redis-backed context** ‚Äì `Settings.create_context_providers()` now instantiates `RedisProvider` when `REDIS_URL` is present, letting every specialist agent ground responses against shared indexes.
- **Persistent chat history** ‚Äì Fleet builder wires Magentic managers to `RedisChatMessageStore`, allowing conversation state to survive process restarts without custom plumbing.
- **HITL + streaming fixes** ‚Äì Plan review events no longer buffer the entire Magentic stream, so approvals pause the workflow as expected and console output stays live.
- **Graceful fallbacks** ‚Äì All Redis helpers are optional. When the extra isn‚Äôt installed or `REDIS_URL` is unset, the system stays on in-memory defaults with clear logging.

---

## ‚ú® Detailed Changes

### Redis Integration
- Added `Settings.redis_chat_message_store_factory()` and `Settings.create_redis_provider()` helpers with configuration hooks under `workflow.redis`.
- Extended agent factories (orchestrator, researcher, coder, analyst) to automatically inject Redis context providers.
- Fleet builder now passes the Redis chat-store factory into `with_standard_manager`, centralising persistence via Agent Framework primitives.
- Updated docs to document the new configuration surface and release.

### Workflow Hardening
- Fixed Magentic streaming loop to consume events incrementally, ensuring plan-review requests block until an approval decision is returned.
- Approval handler wiring now routes through `set_approval_handler` so CLI HITL policies finally gate code execution as defined in `workflow.yaml`.

### Quality & Tooling
- Added regression tests that cover Redis helper fallbacks when the optional dependency is absent.
- Tidied import ordering and typing to keep `ruff` and `mypy` happy with the new helpers.

---

## üöÄ Upgrade Notes

1. **Install Redis extras (optional but recommended):**
   ```bash
   uv pip install agent-framework-redis redisvl
   ```
2. **Export your Redis endpoint** (or copy into `.env`):
   ```bash
   export REDIS_URL="redis://<user>:<password>@<host>:<port>"
   ```
3. **Run migrations/checks:**
   ```bash
   make check
   ```
4. **Tune configuration (optional):** Add a `redis` block to `workflow.yaml` if you‚Äôd like non-default prefixes or vector settings.

Systems without Redis will continue to behave exactly as they did in 0.5.1.

---

## ‚úÖ Validation

- `make check` (ruff + mypy)
- `uv run pytest tests/test_configuration.py::test_redis_helpers_without_dependency`
- Manual smoke test: launch `uv run fleet`, verify streaming approvals and Redis-backed chat resume.

---

For questions or regressions, open an issue or ping **@Qredence/platform**.
